name: Hola Mundo Workflow

on: [push]

jobs:
  consultar_db:
    runs-on: ubuntu-latest
    services:
      personas_db: # Este es el nombre del servicio que definiste
        image: mysql:latest # Cambia la imagen si es diferente
        env:
          MYSQL_ROOT_PASSWORD: Aroman1984
          MYSQL_DATABASE: personas_db
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping" --health-timeout=5s

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Conectar y ejecutar consulta MySQL
        run: |
          # Esperar a que el servicio de la base de datos esté saludable
          echo "Esperando a que la base de datos esté lista..."
          sleep 5 # Esperar unos segundos

          # Intentar conectar y ejecutar la consulta
          mysql -h localhost -u root -pAroman1984 -D personas_db -e "SELECT * FROM personas;"

          # Si quieres hacer algo con los resultados, puedes redirigirlos a un archivo
          # mysql -h localhost -u root -pAroman1984 -D personas_db -e "SELECT * FROM personas;" > resultados.txt
          # cat resultados.txt

          echo "Consulta a la base de datos completada."
          
  saludo_personalizado:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Ejecutar mi acción
        id: mi_accion
        uses: ./.github/actions/my_action
        with:
          my_input: "¡Saludos desde el workflow!"
          my_input2: "Es un placer."

      - name: Mostrar salidas de la acción
        run: |
          echo "El saludo completo generado por la acción es: ${{ steps.mi_accion.outputs.saludo_completo }}"
          echo "El primer mensaje de la acción fue: ${{ steps.mi_accion.outputs.primer_mensaje }}"

  hola:
    runs-on: ubuntu-latest
    needs: saludo_personalizado
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Ejecutar comandos básicos y secretos
        run: |
          echo "Hola Mundo"
          touch hola.txt
          echo "Hola Mundo" >> hola.txt
          echo "Secreto ${{ secrets.PASSWORDPHPMYADMIN }}" >> hola.txt
          cat hola.txt

  other:
    runs-on: ubuntu-latest
    needs: hola
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: LS
        run: ls -la

      - name: Ejecutar script Linux
        run: |
          ls -la
          sudo apt-get update
          chmod +x ./.github/script.sh
          ./.github/script.sh
      - name: Setup Node.js environment
        uses: actions/setup-node@v4.4.0
        with:
          node-version: latest

      - name: node version
        run: node --version

      - name: PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          extensions: mbstring, xml, curl, zip, gd, mysqli, pdo_mysql, bcmath, soap, intl, redis
          coverage: none
          tools: composer:v2.1.3